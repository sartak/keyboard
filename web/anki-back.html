{{FrontSide}}

<hr id="answer" />

<div class="input-field">{{Input}}</div>

<style>
  :root {
    --desired-width: min(95vw, calc(90vh / var(--keymap-ratio)));
  }

  {{keymap.css}}
</style>

{{keymap.html}}

<script>
  {{keymap.js}}
  {{parse-card.js}}

  const jq = window.jQuery || ((cb) => cb());
  jq(() => {
    const layout = {{layout}};

    const input = document.querySelector('.input-field').innerText;

    const segments = parseInput(layout, input);

    initializeKeymap(layout);

    const draw = ({ layer, shift, ctrl, alt, gui, downKeys, holdKeys, isChord }, clear) => {
      drawKeymap(layout, { layer, shift, ctrl, alt, gui });

      downKeys.forEach((key) => {
        highlightKey(key, isChord ? 'chord-tap' : 'down');
      });

      holdKeys.forEach((key) => {
        highlightKey(key, isChord ? 'chord-hold' : 'hold');
      });

      if (clear) {
        setTimeout(() => {
          drawKeymap(layout, { layer: "Alpha", shift: false, ctrl: false, alt: false, gui: false });
          clearHighlights();
        }, clear);
      }
    }

    if (segments.length === 1) {
      setKeymapStatic();
      draw(segments[0]);
    } else {
      draw(segments[0], 500);
      let i = 0;
      setInterval(() => {
        i++;
        if (i === segments.length) {
          i = -1;
          return;
        }
        draw(segments[i], 500);
      }, 1000);
    }
  });
</script>
