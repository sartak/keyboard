{{FrontSide}}

<hr id=answer>

<div class="input-field">{{Input}}</div>

<div class="ferris-sweep hidden">
  <div class="fingers container">
    <div class="left pinky">
      <div class="top">&nbsp;</div>
      <div class="mid">&nbsp;</div>
      <div class="bot">&nbsp;</div>
    </div>
    <div class="left ring">
      <div class="top">&nbsp;</div>
      <div class="mid">&nbsp;</div>
      <div class="bot">&nbsp;</div>
    </div>
    <div class="left middle">
      <div class="top">&nbsp;</div>
      <div class="mid">&nbsp;</div>
      <div class="bot">&nbsp;</div>
    </div>
    <div class="left index">
      <div class="top">&nbsp;</div>
      <div class="mid">&nbsp;</div>
      <div class="bot">&nbsp;</div>
    </div>
    <div class="left center">
      <div class="top">&nbsp;</div>
      <div class="mid">&nbsp;</div>
      <div class="bot">&nbsp;</div>
    </div>
    <div class="right center">
      <div class="top">&nbsp;</div>
      <div class="mid">&nbsp;</div>
      <div class="bot">&nbsp;</div>
    </div>
    <div class="right index">
      <div class="top">&nbsp;</div>
      <div class="mid">&nbsp;</div>
      <div class="bot">&nbsp;</div>
    </div>
    <div class="right middle">
      <div class="top">&nbsp;</div>
      <div class="mid">&nbsp;</div>
      <div class="bot">&nbsp;</div>
    </div>
    <div class="right ring">
      <div class="top">&nbsp;</div>
      <div class="mid">&nbsp;</div>
      <div class="bot">&nbsp;</div>
    </div>
    <div class="right pinky">
      <div class="top">&nbsp;</div>
      <div class="mid">&nbsp;</div>
      <div class="bot">&nbsp;</div>
    </div>
  </div>
  <div class="thumbs container">
    <div class="left thumb">
      <div class="out">&nbsp;</div>
      <div class="in">&nbsp;</div>
    </div>
    <div class="right thumb">
      <div class="in">&nbsp;</div>
      <div class="out">&nbsp;</div>
    </div>
  </div>
</div>
<script>
  setTimeout(() => {
    const Left = "left";
    const Right = "right";
    const Pinky = "pinky";
    const Ring = "ring";
    const Middle = "middle";
    const Index = "index";
    const Center = "center";
    const Thumb = "thumb";
    const Top = "top";
    const Mid = "mid";
    const Bot = "bot";
    const In = "in";
    const Out = "out";

    const labels = {
      Alpha: {
        Ret: "↵",
        Bksp: "⌫",
        Symbol: "λ",
        Number: "#",
        Spc: "␣",
        Shift: "⇧",
        Tab: "⇥",
        Dup: "⨧",
      },

      Shift: {
        Ret: "↵",
        Bksp: "⌫",
        Spc: "␣",
        Symbol: "λ",
        Number: "#",
        Tab: "⇥",
        Dup: "⨧",

        a: "A",
        b: "B",
        c: "C",
        d: "D",
        e: "E",
        f: "F",
        g: "G",
        h: "H",
        i: "I",
        j: "J",
        k: "K",
        l: "L",
        m: "M",
        n: "N",
        o: "O",
        p: "P",
        q: "Q",
        r: "R",
        s: "S",
        t: "T",
        u: "U",
        v: "V",
        w: "W",
        x: "X",
        y: "Y",
        z: "Z",
        "'": '"',
        ".": "???",
        ",": "???",
      },

      AlphaHold: {
        Ret: "⌘↵",
        Bksp: "⇧",
        Symbol: "λ",
        Number: "#",
        Spc: "⌥",
        Tab: "#",
        Dup: "λ",

        a: "⌘A",
        b: "⌘B",
        c: "⌘C",
        d: "⌘D",
        e: "⌘E",
        f: "⌘F",
        g: "⌘G",
        h: "⌘H",
        i: "⌘I",
        j: "⌘J",
        k: "⌘K",
        l: "⌘L",
        m: "⌘M",
        n: "⌘N",
        o: "⌘O",
        p: "⌘P",
        q: "⌘Q",
        r: "⌘R",
        s: "⌘S",
        t: "⌘T",
        u: "⌘U",
        v: "⌘V",
        w: "⌘W",
        x: "⌘X",
        y: "⌘Y",
        z: "⌘Z",
        "'": "Esc",
        ".": "Tab",
        ",": "Alfr",
      },

      Symbol: {
        Ret: "↵",
        Bksp: "⌫",
        Symbol: "A",
        Number: "#",
        Spc: "␣",

        a: "|",
        b: "$",
        c: "&",
        d: "[",
        e: "-",
        f: "}",
        g: "<",
        h: "]",
        i: "+",
        j: "@",
        k: "…",
        l: "~",
        m: ">",
        n: ")",
        o: "/",
        p: "{",
        q: "—",
        r: "*",
        s: "=",
        t: "(",
        u: "#",
        v: "_",
        w: "`",
        x: "^",
        y: "\\",
        z: "%",
      },
      SymbolHold: {
        a: "⌘|",
        b: "⌘$",
        c: "⌘&",
        d: "⌘[",
        e: "⌘-",
        f: "⌘}",
        g: "⌘<",
        h: "⌘]",
        i: "⌘+",
        j: "⌘@",
        k: "⌘…",
        l: "⌘~",
        m: "⌘>",
        n: "⌘)",
        o: "⌘/",
        p: "⌘{",
        q: "⌘—",
        r: "⌘*",
        s: "⌘=",
        t: "⌘(",
        u: "⌘#",
        v: "⌘_",
        w: "⌘`",
        x: "⌘^",
        y: "⌘\\",
        z: "⌘%",
      },
      Number: {
        Ret: "↵",
        Bksp: "⌫",
        Symbol: "A",
        Number: "λ",
        Spc: "␣",

        a: "→",
        b: "ScSh",
        c: "Lang",
        d: "7",
        e: "↓",
        f: "Prev",
        g: "0",
        h: "Zoom\nIn", 
        i: "↑",
        j: "9",
        k: "Lock",
        l: "6",
        m: "VlUp",
        n: "←",
        o: "Play",
        p: "4",
        q: "BrDn",
        r: "3",
        s: "2",
        t: "1",
        u: "Next",
        v: "8",
        w: "BrUp",
        x: "VlDn",
        y: "5",
        z: "Mute",
      },
      NumberShift: {
        Ret: "↵",
        Bksp: "⌫",
        Symbol: "A",
        Number: "λ",
        Spc: "␣",
        h: "Zoom\nOut", 
      },
      NumberHold: {
        a: "⌘→",
        d: "⌘7",
        e: "⌘↓",
        g: "⌘0",
        i: "⌘↑",
        j: "⌘9",
        l: "⌘6",
        n: "⌘←",
        p: "⌘4",
        r: "⌘3",
        s: "⌘2",
        t: "⌘1",
        v: "⌘8",
        y: "⌘5",
      },  
     Function: {
        w: 'Boot',
        "'": 'Boot',
        "b": "Re\nboot",
        "z": "Re\nboot",
        g: 'Clr',
        k: 'Tog',
        t: 'BT6',
        s: 'BT5',
        r: 'BT4',
        d: 'BT3',
        v: 'BT2',
        j: 'BT1',
     },
    };

    const positions = {
      a: [Right, Pinky, Mid],
      b: [Left, Center, Top],
      c: [Left, Pinky, Mid],
      d: [Left, Index, Bot],
      e: [Right, Middle, Mid],
      f: [Right, Index, Top],
      g: [Left, Center, Mid],
      h: [Right, Index, Bot],
      i: [Right, Ring, Mid],
      j: [Left, Ring, Bot],
      k: [Left, Center, Bot],
      l: [Left, Ring, Top],
      m: [Right, Center, Mid],
      n: [Right, Index, Mid],
      o: [Right, Middle, Top],
      p: [Left, Index, Top],
      q: [Left, Pinky, Bot],
      r: [Left, Ring, Mid],
      s: [Left, Middle, Mid],
      t: [Left, Index, Mid],
      u: [Right, Ring, Top],
      v: [Left, Middle, Bot],
      w: [Left, Pinky, Top],
      x: [Right, Center, Bot],
      y: [Left, Middle, Top],
      z: [Right, Center, Top],
      "'": [Right, Pinky, Top],
      ".": [Right, Middle, Bot],
      ",": [Right, Ring, Bot],
      Ret: [Right, Pinky, Bot],
      Symbol: [Left, Thumb, Out],
      Dup: [Left, Thumb, Out],
      Bksp: [Left, Thumb, In],
      Shift: [Left, Thumb, In],
      Ctrl: [Right, Thumb, In],
      Spc: [Right, Thumb, In],
      Number: [Right, Thumb, Out],
      Tab: [Right, Thumb, Out],
    };

    let layer = "Alpha";
    let tap = false;
    let hold = false;
    let shift = false;
    const letters = [];
    const layers = [];

    document
      .querySelector(".input-field")
      .innerText.split("\n")
      .forEach((line) => {
        line.split(" ").forEach((word) => {
          if (word === 'Tap') {
            tap = true;
          }
          else if (word === 'Hold') {
            hold = true;
          }
          else if (labels[word]) {
            layer = word;
            layers.push(layer);
            if (layer === 'Function') {
              letters.push('Symbol');
              letters.push('Number');
            } else if (layer !== 'AlphaHold') {
              letters.push(layer);
            }
          } else {
            letters.push(word);
          }
        });
      });

    const multilayer = layers.sort().join("");

    letters.forEach((letter) => {
      const position = positions[letter];
      if (!position) {
        alert(`No position for letter: ${letter}`);
        return;
      }
      const [hand, finger, pos] = position;
      const el = document.querySelector(
        `.ferris-sweep .${hand}.${finger} .${pos}`
      );
      let label = letter;
      if (tap || hold || (layer === 'Function' && labels[letter])) {
        if (labels.Alpha[letter]) {
          label = labels.Alpha[letter];
        }
      } else {
        if (labels[multilayer] && labels[multilayer][letter]) {
          label = labels[multilayer][letter];
        }
        else if (labels[layer] && labels[layer][letter]) {
          label = labels[layer][letter];
        }
      }

      if (hold || (!tap && layer !== 'Function' && (layer === 'AlphaHold' || labels[letter]))) {
        if (hold && labels[layer + 'Hold'][letter]) {
          label = labels[layer + 'Hold'][letter];
        }
        else if (layer !== 'AlphaHold' && labels.Alpha[letter]) {
          label = labels.Alpha[letter];
        }
        el.classList.add("held");
      } else {
        el.classList.add("highlight");
      }

      el.innerText = label;
    });

    document.querySelector('.ferris-sweep').classList.remove('hidden');
  });
</script>
